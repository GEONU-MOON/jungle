<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />

    <!-- JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
      integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
      crossorigin="anonymous"
    ></script>

    <title>나홀로 메모장 ver2.0</title>

    <!-- style -->
    <style type="text/css">
      #input-title {
        width: 500px;
      }
      #input-text {
        width: 500px;
      }
      .card-link {
        color: white;
      }
    </style>
    <script>
      $(document).ready(function () {
        //문서 초기화 코드
        showMemo();
      });

      function postMemo() {
        // 1. 유저가 입력한 데이터를 #input-title과 #input-text에서 가져오기
        let title = $("#input-title").val();
        let text = $("#input-text").val();

        // 2. memo에 POST 방식으로 메모 생성 요청하기
        $.ajax({
          type: "POST", // POST 방식으로 요청하겠다.
          url: "/memo", // /memo라는 url에 요청하겠다.
          data: { title_give: title, text_give: text }, // 데이터를 주는 방법
          success: function (response) {
            // 성공하면
            if (response["result"] == "success") {
              alert("포스팅 성공!");
              // 3. 성공 시 리스트 새로고침하기
              showMemo();
              $("#input-title").val(""); // 제목 입력 필드 비우기
              $("#input-text").val(""); // 내용 입력 필드 비우기
            } else {
              alert("서버 오류!");
            }
          },
        });
      }

      function showMemo() {
        $("#card-list").html("");
        $.ajax({
          type: "GET",
          url: "/memo",
          data: {},
          success: function (response) {
            let memos = response["memos"];
            for (let i = 0; i < memos.length; i++) {
              makeMemo(memos[i]["title"], memos[i]["text"]);
            }
          },
        });
      }

      function makeMemo(title, text) {
        let temp_html = `<div class="card" style="width: 300px;">
                            <div class="card-body">
                            <h5 class="card-title">${title}</h5>
                            <h6 class="card-text">${text}</h6> 
                            <span class="badge badge-info">                       
                            <a href="#" class="card-link">수정</a>
                            </span>
                            <span class="badge badge-danger">
                            <a href="#" class="card-link">삭제</a>
                            </span>
                            </div>
                        </div>`;
        $("#card-list").append(temp_html);
      }
    </script>
  </head>

  <body>
    <div class="wrap">
      <div class="jumbotron">
        <h1 class="display-4">
          나홀로메모장 <span class="badge badge-secondary">ver2.0</span>
        </h1>
        <div>
          <div class="form-group">
            <label for="input-title"></label>
            <input
              id="input-title"
              class="form-control"
              placeholder="제목을 입력하세요"
            />
          </div>
          <div class="form-group">
            <label for="input-text"></label>
            <textarea
              id="input-text"
              class="form-control"
              placeholder="내용을 입력하세요"
              rows="2"
            ></textarea>
          </div>
        </div>
        <button onclick="postMemo()" type="submit" class="btn btn-primary">
          저장하기
        </button>
      </div>
      <div id="card-list" class="card-columns">
        <!-- 메모 카드들이 추가될 부분 -->
      </div>
    </div>
  </body>
</html>
